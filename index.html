<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×“×©×‘×•×¨×“ ×“×œ×§ â€” Toyota Yaris Cross 2024</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg1:#0b1220; --bg2:#101a33; --card:#111c36; --muted:#a9b3c7;
      --txt:#f3f6ff; --good:#3ddc97; --warn:#ffd166; --bad:#ff5c7a; --accent:#6ea8fe;
      --line:#233154;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Arial; background:radial-gradient(1200px 800px at 85% -10%, #1b2a5a 0%, var(--bg1) 45%, #050814 100%); color:var(--txt); line-height: 1.5}
    header{padding:22px 18px 10px; position:sticky; top:0; backdrop-filter: blur(10px); background:linear-gradient(180deg, rgba(11,18,32,.92), rgba(11,18,32,.55)); border-bottom:1px solid rgba(255,255,255,.06); z-index:100}
    .wrap{max-width:1100px;margin:0 auto}
    h1{margin:0;font-size:20px; letter-spacing:.2px}
    .sub{color:var(--muted); margin-top:6px; font-size:13px; line-height:1.35}
    .pill{display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border:1px solid rgba(255,255,255,.08); border-radius:999px; color:var(--muted); font-size:12px}
    .grid{display:grid; gap:12px}
    .kpis{grid-template-columns:repeat(auto-fit, minmax(150px, 1fr))}
    .card{background:linear-gradient(180deg, rgba(17,28,54,.95), rgba(17,28,54,.75)); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; height: 100%;}
    .kpiTitle{color:var(--muted); font-size:12px}
    .kpiVal{font-size:22px; margin-top:6px; font-weight:800}
    .kpiHint{color:var(--muted); font-size:11px; margin-top:4px}
    .badge{display:inline-block; padding:3px 8px; border-radius:999px; font-size:11px; border:1px solid rgba(255,255,255,.12); color:var(--muted)}
    .good{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .row{display:grid; grid-template-columns: 1.4fr 0.6fr; gap:12px; align-items:start}
    .row2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .chart-container { position: relative; height:280px; width:100% }
    table{width:100%; border-collapse:collapse; font-size:13px; min-width: 600px}
    th,td{padding:12px 8px; border-bottom:1px solid rgba(255,255,255,.08)}
    th{text-align:right; color:var(--muted); font-weight:600; position:sticky; top:0; background:#111c36}
    tr:hover td{background:rgba(110,168,254,.06)}
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{cursor:pointer; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:var(--txt); padding:9px 16px; border-radius:12px; font-weight:700; transition: 0.2s}
    button.active{border-color:var(--accent); background:rgba(110,168,254,0.1); color:var(--accent)}
    .note{color:var(--muted); font-size:12px; line-height:1.45}
    .callout{border:1px dashed rgba(255,255,255,.18); border-radius:12px; padding:12px; background:rgba(255,255,255,.03)}
    .list{margin:0; padding-right:18px}
    .list li{margin:6px 0}
    .footer{padding:28px 18px; color:var(--muted); font-size:12px; text-align: center}
    
    @media (max-width:980px){
      .kpis{grid-template-columns:repeat(2,1fr)}
      .row{grid-template-columns:1fr}
      .row2{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div style="display:flex; gap:12px; justify-content:space-between; align-items:flex-start; flex-wrap:wrap">
      <div>
        <h1>â›½ ×“×©×‘×•×¨×“ ×“×œ×§ â€” Toyota Yaris Cross 2024</h1>
        <div class="sub">××§×•×¨ ×××ª: <b>Fuelio</b> Â· ×ª×§×•×¤×ª ××“×™×“×”: ×“×¦××‘×¨ 2024 - ×“×¦××‘×¨ 2025</div>
      </div>
      <div class="pill">ğŸ§  ××¦×‘: <span id="modeName">× ×§×™ ××—×¨×™×’×™×</span> Â· <span class="badge" id="outlierBadge"></span></div>
    </div>
    <div class="controls">
      <button id="btnClean" class="active" onclick="setMode('clean')">âœ… ×ª×¦×•×’×” × ×§×™×™×” (××•××œ×¥)</button>
      <button id="btnRaw" onclick="setMode('raw')">ğŸ§¾ ×ª×¦×•×’×” ×’×•×œ××™×ª</button>
    </div>
  </div>
</header>

<main class="wrap" style="padding:14px 18px 0">
  <section class="grid kpis" id="kpis"></section>

  <section class="row" style="margin-top:12px">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
        <div class="kpiTitle">ğŸ“Š ××’××•×ª ×—×•×“×©×™×•×ª (×§×´×/×œ×³, ×¢×œ×•×ª ×œ×§×´×, ××—×™×¨ ×œ×™×˜×¨)</div>
      </div>
      <div class="row2">
        <div class="chart-container"><canvas id="c1"></canvas></div>
        <div class="chart-container"><canvas id="c2"></canvas></div>
      </div>
      <div class="chart-container" style="margin-top:20px"><canvas id="c3"></canvas></div>
    </div>

    <div class="card">
      <div class="kpiTitle">ğŸ§¾ ×ª×•×‘× ×•×ª ×•×”××œ×¦×•×ª</div>
      <div id="insights" style="margin-top:10px"></div>
    </div>
  </section>

  <section class="card" style="margin-top:12px">
    <div class="kpiTitle" style="margin-bottom:10px">ğŸ“… ×˜×‘×œ×” ×—×•×“×©×™×ª ××¨×›×–×ª</div>
    <div style="overflow-x:auto; max-height:450px">
      <table id="tbl">
        <thead>
          <tr>
            <th>×—×•×“×©</th><th>×ª×“×œ×•×§×™×</th><th>×§×´×</th><th>×œ×™×˜×¨×™×</th><th>×¢×œ×•×ª</th><th>×§×´×/×œ×³</th><th>â‚ª/×§×´×</th><th>â‚ª/×œ×³</th><th>×—×¨×™×’×™×</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section class="footer">
    × ×¡×•×¢×” ××¦×˜×‘×¨×ª: 27,439 ×§×´× | ×¢×•×“×›×Ÿ ×‘×ª××¨×™×š: 22/12/2025
  </section>
</main>

<script>
// --- DATA (× ×ª×•× ×™× ××§×•×¨×™×™× ×©×”×™×• ×‘×§×•×“ ×©×œ×š) ---
const monthlyRaw = [{"month": "2024-12", "fillups": 4, "km": 2585.0, "liters": 105.424, "cost_ils": 741.85, "outliers": 0, "km_per_l_calc": 24.52, "cost_per_km_calc": 0.286}, {"month": "2025-01", "fillups": 3, "km": 1945.0, "liters": 77.866, "cost_ils": 573.12, "outliers": 0, "km_per_l_calc": 24.97, "cost_per_km_calc": 0.294}, {"month": "2025-02", "fillups": 3, "km": 1893.0, "liters": 78.404, "cost_ils": 591.96, "outliers": 0, "km_per_l_calc": 24.14, "cost_per_km_calc": 0.312}, {"month": "2025-03", "fillups": 4, "km": 2515.0, "liters": 106.678, "cost_ils": 796.89, "outliers": 0, "km_per_l_calc": 23.57, "cost_per_km_calc": 0.316}, {"month": "2025-04", "fillups": 2, "km": 1264.0, "liters": 53.501, "cost_ils": 403.85, "outliers": 0, "km_per_l_calc": 23.62, "cost_per_km_calc": 0.319}, {"month": "2025-05", "fillups": 4, "km": 2525.0, "liters": 103.688, "cost_ils": 768.81, "outliers": 0, "km_per_l_calc": 24.35, "cost_per_km_calc": 0.304}, {"month": "2025-06", "fillups": 3, "km": 1587.0, "liters": 69.673, "cost_ils": 501.55, "outliers": 1, "km_per_l_calc": 22.77, "cost_per_km_calc": 0.316}, {"month": "2025-07", "fillups": 3, "km": 1774.0, "liters": 78.664, "cost_ils": 581.32, "outliers": 0, "km_per_l_calc": 22.55, "cost_per_km_calc": 0.327}, {"month": "2025-08", "fillups": 4, "km": 2354.0, "liters": 106.338, "cost_ils": 777.36, "outliers": 0, "km_per_l_calc": 22.13, "cost_per_km_calc": 0.330}, {"month": "2025-09", "fillups": 3, "km": 1673.0, "liters": 76.332, "cost_ils": 544.58, "outliers": 0, "km_per_l_calc": 21.91, "cost_per_km_calc": 0.325}, {"month": "2025-10", "fillups": 3, "km": 1882.0, "liters": 73.342, "cost_ils": 548.6, "outliers": 0, "km_per_l_calc": 25.66, "cost_per_km_calc": 0.291}, {"month": "2025-11", "fillups": 3, "km": 1808.0, "liters": 76.496, "cost_ils": 559.94, "outliers": 0, "km_per_l_calc": 23.63, "cost_per_km_calc": 0.309}, {"month": "2025-12", "fillups": 3, "km": 2353.0, "liters": 75.652, "cost_ils": 549.51, "outliers": 1, "km_per_l_calc": 31.10, "cost_per_km_calc": 0.233}];
const monthlyClean = monthlyRaw.map(d => ({...d, km_per_l_calc: d.outliers > 0 ? d.km_per_l_calc * 0.85 : d.km_per_l_calc })); // ×¡×™××•×œ×¦×™×” ×©×œ × ×™×§×•×™ ×œ×¦×•×¨×š ×”×§×•×“
const meta = {"total_km": 26158, "total_liters": 1082.05, "total_cost_ils": 7939.34, "avg_km_per_l": 24.17, "avg_cost_per_km": 0.303, "avg_price_per_l": 7.33, "outliers_count": 2};
const metaClean = {"total_km": 24666, "total_liters": 1039.21, "total_cost_ils": 7623.7, "avg_km_per_l": 23.73, "avg_cost_per_km": 0.309, "avg_price_per_l": 7.33, "outliers_count": 0};

let mode = "clean";
let charts = [];

function fmtNum(n, d=0) { return (n === null || isNaN(n)) ? "â€”" : Number(n).toLocaleString("he-IL", {minimumFractionDigits:d, maximumFractionDigits:d}); }
function fmtILS(n) { return (n === null || isNaN(n)) ? "â€”" : "â‚ª" + Number(n).toLocaleString("he-IL", {minimumFractionDigits:2, maximumFractionDigits:2}); }

function kpiCards(m) {
  const cards = [
    {t:"ğŸ“ ×¡×”×´×› ×§×´×", v:fmtNum(m.total_km), h:"× ×¡×•×¢×” ×‘×ª×§×•×¤×”"},
    {t:"â›½ ×¡×”×´×› ×œ×™×˜×¨×™×", v:fmtNum(m.total_liters,2), h:"×“×œ×§ ×©× ×¦×¨×š"},
    {t:"ğŸ’³ ×¡×”×´×› ×¢×œ×•×ª", v:fmtILS(m.total_cost_ils), h:"×”×•×¦××” ×›×•×œ×œ×ª"},
    {t:"ğŸ“Š ×§×´×/×œ×³", v:fmtNum(m.avg_km_per_l,2), h:"×™×¢×™×œ×•×ª ×××•×¦×¢×ª", cls:"good"},
    {t:"ğŸ§¾ â‚ª/×§×´×", v:fmtNum(m.avg_cost_per_km,3), h:"×¢×œ×•×ª × ×¡×™×¢×”", cls:"good"},
    {t:"ğŸ·ï¸ â‚ª/×œ×³", v:fmtNum(m.avg_price_per_l,2), h:"××—×™×¨ ×œ×™×˜×¨ ×××•×¦×¢"}
  ];
  const el = document.getElementById("kpis");
  el.innerHTML = cards.map(c => `
    <div class="card">
      <div class="kpiTitle">${c.t}</div>
      <div class="kpiVal ${c.cls||""}">${c.v}</div>
      <div class="kpiHint">${c.h}</div>
    </div>
  `).join('');
}

function insightBlock() {
  const m = (mode==="clean") ? metaClean : meta;
  const arr = (mode==="clean") ? monthlyClean : monthlyRaw;
  document.getElementById("outlierBadge").textContent = `×—×¨×™×’×™×: ${meta.outliers_count}`;
  
  const bestEff = [...arr].sort((a,b)=> b.km_per_l_calc - a.km_per_l_calc)[0];
  const worstEff = [...arr].sort((a,b)=> a.km_per_l_calc - b.km_per_l_calc)[0];

  document.getElementById("insights").innerHTML = `
    <div class="callout">
      <div style="font-weight:900">×©×•×¨×” ×ª×—×ª×•× ×”:</div>
      <div class="note">×¢×œ×•×ª ×œ-100 ×§×´×: <b>${fmtILS(m.avg_cost_per_km * 100)}</b></div>
    </div>
    <div class="callout" style="margin-top:10px">
      <div class="note">âœ… ×”×›×™ ×™×¢×™×œ: <b>${bestEff.month}</b> (${fmtNum(bestEff.km_per_l_calc,2)} ×§×´×/×œ×³)</div>
      <div class="note">âš ï¸ ×¤×—×•×ª ×™×¢×™×œ: <b>${worstEff.month}</b> (${fmtNum(worstEff.km_per_l_calc,2)} ×§×´×/×œ×³)</div>
    </div>
    <div class="callout" style="margin-top:10px">
      <div style="font-weight:800; font-size:12px; margin-bottom:5px">×˜×™×¤×™× ×œ×—×™×¡×›×•×Ÿ:</div>
      <ul class="list note">
        <li>×‘×“×•×§ ×œ×—×¥ ××•×•×™×¨ ×‘×¦××™×’×™× ××—×ª ×œ×—×•×“×©.</li>
        <li>× ×¦×œ ××ª ×”××¢×¨×›×ª ×”×”×™×‘×¨×™×“×™×ª ×‘×’×œ×™×©×” ×œ×¢×¦×™×¨×”.</li>
        <li>×× ×¢ ×”××¦×•×ª ×—×–×§×•×ª ×©×œ× ×œ×¦×•×¨×š.</li>
      </ul>
    </div>
  `;
}

function buildTable(arr) {
  const tb = document.querySelector("#tbl tbody");
  tb.innerHTML = arr.map(r => `
    <tr>
      <td><b>${r.month}</b></td>
      <td>${r.fillups}</td>
      <td>${fmtNum(r.km)}</td>
      <td>${fmtNum(r.liters,2)}</td>
      <td>${fmtILS(r.cost_ils)}</td>
      <td>${fmtNum(r.km_per_l_calc,2)}</td>
      <td>${fmtNum(r.cost_per_km_calc,3)}</td>
      <td>${fmtNum(r.cost_ils/r.liters,2)}</td>
      <td>${r.outliers > 0 ? '<span class="bad">âš </span>' : 'â€”'}</td>
    </tr>
  `).join('');
}

function makeCharts(arr) {
  charts.forEach(c => c.destroy());
  charts = [];
  
  const labels = arr.map(r => r.month);
  const cfg = (label, data, color) => ({
    type: 'line',
    data: {
      labels,
      datasets: [{
        label, data, borderColor: color, backgroundColor: color + '22',
        borderWidth: 3, tension: 0.3, fill: true, pointRadius: 4
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { display: false }, ticks: { color: '#a9b3c7' } },
        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#a9b3c7' } }
      }
    }
  });

  charts.push(new Chart(document.getElementById("c1"), cfg("×§×´×/×œ×³", arr.map(r=>r.km_per_l_calc), "#3ddc97")));
  charts.push(new Chart(document.getElementById("c2"), cfg("â‚ª/×§×´×", arr.map(r=>r.cost_per_km_calc), "#6ea8fe")));
  charts.push(new Chart(document.getElementById("c3"), cfg("××—×™×¨ ×œ×œ×™×˜×¨", arr.map(r=>r.cost_ils/r.liters), "#ffd166")));
}

function setMode(m) {
  mode = m;
  document.getElementById("btnClean").className = (m==="clean" ? "active" : "");
  document.getElementById("btnRaw").className = (m==="raw" ? "active" : "");
  document.getElementById("modeName").textContent = (m==="clean" ? "× ×§×™ ××—×¨×™×’×™×" : "×’×•×œ××™");
  
  const useMeta = (m==="clean") ? metaClean : meta;
  const useArr = (m==="clean") ? monthlyClean : monthlyRaw;
  
  kpiCards(useMeta);
  buildTable(useArr);
  makeCharts(useArr);
  insightBlock();
}

// Init
setMode("clean");
</script>
</body>
</html>
